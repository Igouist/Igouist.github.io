<!doctype html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="utf-8">
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BWMYD757BP"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BWMYD757BP');
    </script>

    <meta name="generator" content="Hugo 0.150.1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <title>.Net: 使用 FeatureManagement 套件來實作功能切換（Feature Toggle）吧 | 伊果的沒人看筆記本</title>
    <meta property="og:title" content=".Net: 使用 FeatureManagement 套件來實作功能切換（Feature Toggle）吧 - 伊果的沒人看筆記本">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2024-08-18T13:00:00&#43;08:00">
        
        
    <meta property="article:modified_time" content="2024-08-18T13:00:00&#43;08:00">
        
        <meta name="keywords" content="FeatureManagement, Feature Flag, Feature Toggle, .Net WhiteList, 功能旗標, 特性切換">
    <meta name="description" content="開發時我們常會使用 Feature Flag (Feature Toggle) 來設置開關並控制程式碼，而在 .Net Core 我們可以用 FeatureManagement 來簡單地做到 Feature Toggle。這篇介紹了 FeatureManagement 的相關實作，如控制 API 啟用／停用、白名單等等">
        <meta name="author" content="Igouist">
        
    <meta property="og:url" content="https://igouist.github.io/post/2024/08/dotnet-feature-flag-and-feature-management/">
    <meta property="og:image" content="https://igouist.github.io/me.jpg">

    <link rel="preconnect" href="https://image.igouist.net" crossorigin>
    
    

    
    

    <link rel="preload"
      href="/fonts/lxgw-wenkai-mono-tc.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script defer src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://igouist.github.io/">
                        伊果的沒人看筆記本
                    </a>
                
                <p class="description">菜雞寫筆記，踩坑全紀錄</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://igouist.github.io/">Home</a>
                    
                    <a  href="https://igouist.github.io/categories/csharp-and-dotnet/" title="CSharp">CSharp</a>
                    
                    <a  href="https://igouist.github.io/categories/life/" title="Life">Life</a>
                    
                    <a  href="https://igouist.github.io/categories/reading/" title="Reading">Reading</a>
                    
                    <a  href="https://igouist.github.io/timeline/" title="Timeline">Timeline</a>
                    
                    <a  href="https://igouist.github.io/archives/" title="Archives">Archives</a>
                    
                    <a  href="https://igouist.github.io/about/" title="About">About</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">.Net: 使用 FeatureManagement 套件來實作功能切換（Feature Toggle）吧</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2024-8-18,
                        </date>
                        
                        <div class="post-meta">
                            
                                <span class="meta-category"><a href="https://igouist.github.io/categories/csharp-and-dotnet">CSharp-and-Dotnet</a></span>
                            
                        </div>
                        
                        
                        <div class="post-meta">(
                            <span id="vercount_container_page_pv">
                                <span id="vercount_value_page_pv">?</span>
                                <span>&nbsp;read</span>
                            </span>)
                        </div>
                        

                        <div class="post-content">
                            <p>


<img
  src="https://image.igouist.net/926KRip.webp"
  alt="Image"width="600" height="569"loading="auto" decoding="async">
</p>
<p>在做上一篇 <a href="/post/2024/08/dotnet-ioptions">IOptions</a> 的筆記時，剛好看到 FeatureManagement 這香東西。<br/>馬上來收錄一篇。順便也簡單整理一下 Feature Flag (≒Feature Toggle) 的介紹。</p>
<div class="toc toc-box">
    <div class="toc-title">章節目錄</div>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#認識一下-feature-flag">認識一下 Feature Flag</a></li>
    <li><a href="#環境準備microsoftfeaturemanagement">環境準備：Microsoft.FeatureManagement</a></li>
    <li><a href="#實作使用-isenabledasync-拿到-feature-flag-的值">實作：使用 IsEnabledAsync 拿到 Feature Flag 的值</a></li>
    <li><a href="#實作使用-featuregate-來啟用和停用-api">實作：使用 FeatureGate 來啟用和停用 API</a></li>
    <li><a href="#實作使用-featurefilter-自訂篩選條件隨機抽取使用者">實作：使用 FeatureFilter 自訂篩選條件、隨機抽取使用者</a></li>
    <li><a href="#實作使用-featurefilter-來根據白名單啟用-api">實作：使用 FeatureFilter 來根據白名單啟用 API</a></li>
    <li><a href="#小結">小結</a></li>
    <li><a href="#參考資料">參考資料</a></li>
  </ul>
</nav>
</div>
<h2 id="認識一下-feature-flag">認識一下 Feature Flag</h2>
<blockquote>
<p>本部落格秉持著「簡單、友善、我好菜」的精神，按照慣例先簡單介紹一下<br/>
已經知道的朋友就可以跳過這個小節，直接前往 #環境準備 囉。</p></blockquote>
<p>假設我們原本有 Old 邏輯：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Old();
</span></span></code></pre></div><p>天庭傳來諭令，要我們改成 New 邏輯。這簡單，我們就把 Old 砍掉，換成 New。非常自然，改完就佈版</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>New();
</span></span></code></pre></div><p>隔天，天庭又傳來諭令，New 需要調整一下，先不要了<br/>
現在我們又需要把 New 邏輯砍掉，讓 Old 邏輯回來。<br/>
簡單，但看來我們得再上一版</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>Old();
</span></span><span style="display:flex;"><span><span style="color:#75715e">// New();</span>
</span></span></code></pre></div><p>再隔天，大家可能猜到天庭又要幹嘛了，總之又上了一版</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Old();</span>
</span></span><span style="display:flex;"><span>New();
</span></span></code></pre></div><p>如此往復三萬八千次，工程師終於受不了了：「俺老孫每天在這切換 Old 跟 New，改完還得佈版，每天搞這些就飽了，我滴媽呀，不幹了」</p>
<p>就在老孫關燈走人的那一瞬間，突然靈光一現：等等，<strong>俺加個開關還不行嗎？</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (NewFunctionEnabled())
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    New();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Old();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>現在只要把這個開關放到外面，別寫死在程式碼裡。丟去什麼 appsettings.json、Config、資料庫、ini、東海龍王廟，隨便</p>
<p>總之丟去個不用佈板就能直接修改的地方，不就完事了嗎？</p>
<p>現在程式碼就像盯著旗手的士兵們，旗手舉了藍色，他們就往左跑；旗手舉了紅色，他們就往右跑。老孫只要把設定給改了，就能一鍵切換邏輯，好不自在。</p>
<p><strong>沒錯，老孫剛剛發現了 Feature Flag</strong>。</p>
<p>有了這個開關，除了開開關關(?)，現在也可以做到更多事情了。</p>
<p>例如新功能想先隨機讓一些使用者踩看看，馬上在這個 <code>NewFunctionEnabled()</code> 開關後面加點料，讓它隨機打開、隨機關起來；</p>
<p>想讓合作好的客戶搶先使用，馬上在這個 <code>NewFunctionEnabled()</code> 開關後面偷塞一張白名單：<br/>你聽好了，看到這些人就幫我按藍色的按鈕，門就會打開</p>
<p>因為我們把開關抽出去了，代表判斷條件和執行邏輯之間的耦合被我們給降低了，<br/>
這樣開關的彈性就變高了，我們也就可以針對開關內部的邏輯動手動腳了</p>
<p>老孫把開關弄出來之後，用得挺爽。一時之間，花果山分部的工程師紛紛效仿老孫，<br/>用這個<strong>香香的 Feature Flag 來從外部動態切換程式碼邏輯</strong>，好不爽快。
<br/>吱聲此起彼落，可謂是：</p>
<blockquote>
<p>兩條邏輯改又改，改完還要等佈版<br/>
有了 Feature Flag，切個開關就下班</p></blockquote>
<p>至於後來開關越埋越多，系統服務七十二變。工程師老孫被迫跟著唐經理去聽研討會，好好學習怎麼管理這些 Feature Flag。還弄了些儀表板、過期時間等等，那又是另一個故事了…</p>
<hr>
<p>故事說到這裡，雖然例子粗暴一點，但朋朋們應該對 Feature Flag 在幹嘛有點了解了（吧？）</p>
<p>如果想要進一步認識 Feature Flag，這邊也準備了一些推薦閱讀。</p>
<p>例如 Feature Flag 還可以用在哪、分成哪些種類；<br/>
兩個 Flag 共用到同一段 Code 怎辦；<br/>
PM 朋朋們又是怎麼運用 Feature Flag 的……</p>
<p>都丟在下面這團，提供給有興趣的朋朋們：</p>
<ul>
<li><a href="https://martinfowler.com/articles/feature-toggles.html">Feature Toggles (aka Feature Flags) - martinFowler</a></li>
<li><a href="https://mileschou.me/blog/feature-toggle-faq/">Feature Toggle 應用常見問題 | Miles&rsquo; Blog</a></li>
<li><a href="https://medium.com/3pm-lab/product-beta-release-planning-and-feature-flags-implementation-1f7673007d23">產品上線規劃：Beta Release、Feature Flags 實作經驗與工具分享 | by Anne Hsiao | 3PM LAB 產品三眼怪實驗室 | Medium</a></li>
<li><a href="https://darrensim.com/2018/introduction-to-feature-toggles-and-implementation-best-practices/">Introduction to Feature Toggles and Implementation Best Practices - Darren Sim</a></li>
</ul>
<hr>
<blockquote>
<p>補充：雖然 Feature Flag 這麼香，但如果開關沒有好好管理，<br/>不小心開到不該開的程式碼邏輯會發生什麼事呢？</p>
<p>泡杯茶，看看實例吧：<a href="https://dougseven.com/2014/04/17/knightmare-a-devops-cautionary-tale/">Knightmare: A DevOps Cautionary Tale – Doug Seven</a></p></blockquote>
<hr>
<blockquote>
<p>補充：Feature Toggle 常常跟主幹開發（Trunk-based Development）一起出現？</p>
<p>蠻常聽到這個問題的，這邊也簡單筆記一下，沒有採用主幹開發的朋朋可以跳過這小段</p>
<p>（想認識 Trunk-based Development 的朋朋們，<br/>　可以右轉去 <a href="https://tw.trunkbaseddevelopment.com/">TrunkBasedDevelopment.com</a>，感謝協助中文化的大大們）</p>
<p>回到問題，我的理解是這樣：</p>
<p>即使我們採用了主幹開發，持續把變更交付到主幹分支上，把大家的 GAP 降到最低，<br/>但一定還是會遇到需要做很久才做得完的功能</p>
<p>我們不想要拉一條 feature 分支，放著漸漸就跟主幹脫節，到時候合併又要大爆炸<br/>
而是想要把這些程式碼持續地整合到我們的程式庫，這樣就能及早發現問題和解除衝突<br/>
可是如果粗暴地合併進去，開發中的功能就會暴露出來…怎麼辦呢？</p>
<p>這種時候，如果有一個開關，來幫助我們關閉尚未完工的功能、打開即將交付的功能。我們就能整合現有的程式碼，也能提早知道合併會不會炸爛其他功能…</p>
<p>很方便對吧？ Feature Toggle 就跳出來啦。香。</p></blockquote>
<h2 id="環境準備microsoftfeaturemanagement">環境準備：Microsoft.FeatureManagement</h2>
<p>好，我們前面簡單介紹了一下 Feature Flag，接著就進入實作階段。</p>
<p>要實現 Feature Flag 的方法有很多，例如我之前都是用<a href="/post/2024/08/dotnet-ioptions">上一篇</a>提到的 IOption 直接從 appsettings.json 把 true/false 讀出來用</p>
<p>而這篇我們要來使用香香的 FeatureManagement 來幫我們實現 Feature Flag 的操作。</p>
<p>首先，我們要先搞到 Microsoft.FeatureManagement.AspNetCore 這個套件：<br/><a href="https://www.nuget.org/packages/Microsoft.FeatureManagement.AspNetCore">NuGet Gallery | Microsoft.FeatureManagement.AspNetCore</a></p>
<p>接著讓我們把它給註冊到我們的 Program.cs：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Program.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 環境準備：Microsoft.FeatureManagement</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 加入 Feature Flag 功能，預設會抓 appsettings.json 中的 &#34;FeatureManagement&#34; 節點</span>
</span></span><span style="display:flex;"><span>builder.Services.AddFeatureManagement();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 如果想要自訂 Feature Flag 在 appsettings.json 裡的位置，可以這樣寫</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//builder.Services.AddFeatureManagement(builder.Configuration.GetSection(&#34;CustomFeatureManagement&#34;));</span>
</span></span></code></pre></div><p>然後為了後續的示範，先開好一組 Controller：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Controllers/DemoController.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// 示範 Feature Flag 的使用</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[ApiController]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[Route(&#34;[controller]</span><span style="color:#e6db74">&#34;)]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DemoController</span> : ControllerBase
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ILogger&lt;DemoController&gt; _logger;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IFeatureManager _featureManager;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> DemoController(
</span></span><span style="display:flex;"><span>        ILogger&lt;DemoController&gt; logger, 
</span></span><span style="display:flex;"><span>        IFeatureManager featureManager)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _logger = logger;
</span></span><span style="display:flex;"><span>        _featureManager = featureManager;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>這樣環境就搞定了，讓我們開始第一組實作吧！</p>
<h2 id="實作使用-isenabledasync-拿到-feature-flag-的值">實作：使用 IsEnabledAsync 拿到 Feature Flag 的值</h2>
<p>假設我們跟上面的老孫一樣：翻寫了一條新版邏輯。<br/>如果開關被打開了，就走新版的路線；關著的話就維持舊版</p>
<p>要達成上面的條件，我們會<strong>需要直接取得某個 Flag 的開關狀態，<br/>這時候就可以使用 <code>IsEnabledAsync</code></strong></p>
<p>先到 appsettings.json 加上我們的 Feature Flag，先叫做 <code>NewLogicEnabled</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#75715e">// appsettings.json
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;FeatureManagement&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;NewLogicEnabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>


<img
  src="https://image.igouist.net/FzIALd8.webp"
  alt="Image"width="884" height="862"loading="auto" decoding="async">
</p>
<p>為了後面方便使用，我習慣先建一組簡單的 Const 來管理這些 Feature Flag：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Flags/FeatureFlags.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FeatureFlags</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 這邊的名稱要和 appsettings.json 裡 FeatureManagement 底下的設定一樣</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> NewLogicEnabled = <span style="color:#e6db74">&#34;NewLogicEnabled&#34;</span>; 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>讓我們加上這次測試用的 API，並且使用 IsEnabledAsync 來抓取指定的 Flag 狀態：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Controllers/DemoController.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Feature Flag 可以讓我們從設定檔中讀取特定的開關</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 並且在程式中根據這些開關來決定是否啟用某些功能</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[HttpGet(&#34;IsEnabledAsync&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;<span style="color:#66d9ef">string</span>&gt; IsFeatureEnabled()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Demo 1: 使用 IsEnabledAsync 拿到 Feature Flag 的值 </span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> isEnabled = <span style="color:#66d9ef">await</span> _featureManager.IsEnabledAsync(FeatureFlags.NewLogicEnabled);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> isEnabled 
</span></span><span style="display:flex;"><span>        ? <span style="color:#e6db74">&#34;香香的新版邏輯已啟用。&#34;</span>
</span></span><span style="display:flex;"><span>        : <span style="color:#e6db74">&#34;新版邏輯尚未啟用，繼續使用臭臭的舊版邏輯。&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>


<img
  src="https://image.igouist.net/O1uxn9W.webp"
  alt="Image"width="746" height="528"loading="auto" decoding="async">
</p>
<p>現在讓我們直接把 appsettings.json 裡的 <code>NewLogicEnabled</code> 改成 false（只要存檔就好了，不需要重啟服務），並且再呼叫一次 API：</p>
<p>


<img
  src="https://image.igouist.net/WTgcapM.webp"
  alt="Image"width="907" height="294"loading="auto" decoding="async">
</p>
<p>來張動圖看看成果：</p>
<p>


<img
  src="https://image.igouist.net/9elZfT7.gif"
  alt="Image"width="2860" height="1660"loading="auto" decoding="async">
</p>
<p>搞定，收工下班。</p>
<h2 id="實作使用-featuregate-來啟用和停用-api">實作：使用 FeatureGate 來啟用和停用 API</h2>
<p>除了根據開關決定要執行哪條路線的邏輯以外，我們也常常根據開關決定某些功能是不是要開放</p>
<p><strong>如果我們需要根據 Feature Flag 來決定是否啟用某支 API，就可以使用 <code>FeatureGate</code></strong></p>
<p>首先讓我們加上第二組 Flag，這次叫做 <code>NiceApiEnabled</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#75715e">// appsettings.json
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;FeatureManagement&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;NewLogicEnabled&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;NiceApiEnabled&#34;</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Flags/FeatureFlags.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FeatureFlags</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> NewLogicEnabled = <span style="color:#e6db74">&#34;NewLogicEnabled&#34;</span>; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// 新增 NiceApiEnabled</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> NiceApiEnabled = <span style="color:#e6db74">&#34;NiceApiEnabled&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>接著就來替我們的 API 掛上 FeatureGate 試試：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Controllers/DemoController.cs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">[HttpGet(&#34;FeatureGate&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[FeatureGate(FeatureFlags.NiceApiEnabled)]</span> <span style="color:#75715e">// 讓 FeatureGate 去檢查我們的 NiceApiEnabled</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> FeatureGate()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Demo 2: 使用 FeatureGate 來啟用和停用 API</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 如果 NiceApiEnabled 是關閉的，這個方法不會被執行，會直接回傳 404</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;這是一個很棒的 API，只有你看得到。&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>NiceApiEnabled</code> 是 true 的時候，可以正常呼叫到 API：



<img
  src="https://image.igouist.net/2el7jVT.webp"
  alt="Image"width="792" height="409"loading="auto" decoding="async">
</p>
<p>而當 <code>NiceApiEnabled</code> 是 false 的時候，這支 API 就 不存在了…



<img
  src="https://image.igouist.net/BV3aomM.webp"
  alt="Image"width="1431" height="469"loading="auto" decoding="async">
</p>
<h2 id="實作使用-featurefilter-自訂篩選條件隨機抽取使用者">實作：使用 FeatureFilter 自訂篩選條件、隨機抽取使用者</h2>
<p>前面我們示範了怎麼看開關狀態，以及根據開關把 API 給 Ban 了。接著來點場景應用吧。</p>
<p>之前遇過需要隨機抽樣去分流的狀況（把 50% 使用者引導去翻寫好的新站台觀察狀況之類的）</p>
<p><strong>像這種需要自己寫某些邏輯來決定開關是否開啟的場合，就可以使用 FeatureFilter 來實現</strong></p>
<hr>
<p>跟前兩個範例一樣，我們需要先去 <code>appsettings.json</code> 掛上我們的 Feature Flag。既然是要隨機抽取幸運兒體驗我們的新功能，就叫做 <code>RandomTrial</code></p>
<p>但要注意，當我們要自訂 Flag 啟用的條件（也就是需要跑過某些邏輯才能決定是 true/false）的時候，就不能像前面兩個範例一樣簡單丟個 <code>&quot;RandomTrial&quot;:true</code> 就搞定</p>
<p>而是要使用 <code>EnabledFor</code>，並在裡面標示出我們要呼叫的 FeatureFilter 名稱、需要傳遞的參數，這樣 FeatureManagement 才知道它得依序跑過這些 FeatureFilter</p>
<p>假設我們希望有 50% 的使用者會隨機抽中新功能。我們就可以先在 <code>EnabledFor</code> 裡掛一條叫做「Random」的 FeatureFilter，並且丟個 Percentage=50 的參數進去：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#75715e">// appsettings.json
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;FeatureManagement&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;NewLogicEnabled&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;NiceApiEnabled&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;RandomTrial&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;EnabledFor&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Random&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Parameters&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;Percentage&#34;</span>: <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Flags/FeatureFlags.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FeatureFlags</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> NewLogicEnabled = <span style="color:#e6db74">&#34;NewLogicEnabled&#34;</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> NiceApiEnabled = <span style="color:#e6db74">&#34;NiceApiEnabled&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 新增 RandomTrial</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> RandomTrial = <span style="color:#e6db74">&#34;RandomTrial&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>接著讓我們實作對應的 FeatureFilter，這邊作法就可以粗暴一點：</p>
<ul>
<li>從 <code>context.Parameters</code> 把前面設好的 Percentage 參數拉出來</li>
<li>現場骰下去看有沒有過門檻，沒過就掰掰</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Filters/RandomFilter.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// 隨機啟用 API 的 Filter</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;see ref=&#34;https://learn.microsoft.com/zh-tw/azure/azure-app-configuration/howto-feature-filters-aspnet-core&#34;/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[FilterAlias(&#34;Random&#34;)]</span> <span style="color:#75715e">// 設定 Filter 的別名，讓 appsettings.json 可以使用這個別名</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RandomFilter</span> : IFeatureFilter
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Task&lt;<span style="color:#66d9ef">bool</span>&gt; EvaluateAsync(FeatureFilterEvaluationContext context)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> percentage = context.Parameters.GetValue&lt;<span style="color:#66d9ef">int</span>&gt;(<span style="color:#e6db74">&#34;Percentage&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> seed = Guid.NewGuid().GetHashCode();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> randomNumber = <span style="color:#66d9ef">new</span> Random(seed).Next(<span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> isEnabled = randomNumber &lt;= percentage;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Task.FromResult(isEnabled);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>接著我們要把這個 FeatureFilter 拿去註冊：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Program.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder.Services
</span></span><span style="display:flex;"><span>    .AddFeatureManagement()
</span></span><span style="display:flex;"><span>    .AddFeatureFilter&lt;RandomFilter&gt;() <span style="color:#75715e">// 加入自訂的 Feature Filter. see: Filters/RandomFilter.cs</span>
</span></span><span style="display:flex;"><span>    ;
</span></span></code></pre></div><p>接著就像前面的兩個範例一樣，直接拿來用就好嚕</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Controllers/DemoController.cs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">[HttpGet(&#34;FeatureFilter/Random/&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;<span style="color:#66d9ef">string</span>&gt; FeatureFilterRandom()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Demo 3: 實作：使用 IFeatureFilter 來隨機啟用 API - 直接查詢 Feature Flag</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> isEnabled = <span style="color:#66d9ef">await</span> _featureManager.IsEnabledAsync(FeatureFlags.RandomTrial);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> isEnabled 
</span></span><span style="display:flex;"><span>        ? <span style="color:#e6db74">&#34;恭喜你！你抽中了香香新版邏輯的試用機會！&#34;</span>
</span></span><span style="display:flex;"><span>        : <span style="color:#e6db74">&#34;什麼事也沒發生，又是臭臭邏輯的一天。&#34;</span>;
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">[HttpGet(&#34;FeatureFilter/Random/FeatureGate&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[FeatureGate(FeatureFlags.RandomTrial)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> FeatureFilterRandomWithFeatureGate()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Demo 3: 實作：使用 IFeatureFilter 來隨機啟用 API - 透過 FeatureGate 來啟用</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;恭喜你！你抽中了很棒 API 的試用機會！&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>來張動圖看看成果：</p>
<p>


<img
  src="https://image.igouist.net/9l8N7EE.gif"
  alt="Image"width="1741" height="1267"loading="auto" decoding="async">
</p>
<h2 id="實作使用-featurefilter-來根據白名單啟用-api">實作：使用 FeatureFilter 來根據白名單啟用 API</h2>
<p>接下來試試另一組場景，假設我們打算先讓十位合作客戶試用新功能，<br/>這時候也可以靠自製 FeatureFilter 來處理。</p>
<blockquote>
<p>備註：這一節會需要用到依賴注入相關的功能，還不熟的朋友可以參見<a href="/post/2021/11/newbie-6-dependency-injection/">依賴注入的筆記</a></p></blockquote>
<p>首先按照慣例，先加上我們的 Feature Flag<br/>
這次就叫做 <code>Whitelist</code>，並且只指定 FeatureFilter 的名稱就好，不需要參數：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#75715e">// appsettings.json
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;FeatureManagement&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;NewLogicEnabled&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;NiceApiEnabled&#34;</span>: <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;RandomTrial&#34;</span>: {}, <span style="color:#75715e">// 好長，省略
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Whitelist&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;EnabledFor&#34;</span>: [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Whitelist&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Flags/FeatureFlags.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FeatureFlags</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> NewLogicEnabled = <span style="color:#e6db74">&#34;NewLogicEnabled&#34;</span>; 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> NiceApiEnabled = <span style="color:#e6db74">&#34;NiceApiEnabled&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> RandomTrial = <span style="color:#e6db74">&#34;RandomTrial&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 新增 Whitelist</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">string</span> Whitelist = <span style="color:#e6db74">&#34;Whitelist&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>接著，假裝一下我們在某張資料表裏面有白名單資料：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Repositories/WhitelistRepository.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IWhitelistRepository</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Task&lt;IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt;&gt; GetWhitelistAsync();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WhitelistRepository</span> : IWhitelistRepository
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;IEnumerable&lt;<span style="color:#66d9ef">string</span>&gt;&gt; GetWhitelistAsync()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 假裝從資料庫中取得白名單 :)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> List&lt;<span style="color:#66d9ef">string</span>&gt;
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Apple&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Banana&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Cat&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 小提醒：如果真的連線到資料庫，然後名單的改動頻率很低，可以考慮加個快取</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>而且這個 Repo 也有好好註冊到 Program.cs。<br/>
同時，因為後續的示範一定也需要從 Request 拿到使用者的身分<br/>
這邊也註冊了 IHttpContextAccessor 來取得 Request 內容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Program.cs</span>
</span></span><span style="display:flex;"><span>builder.Services.AddHttpContextAccessor();
</span></span><span style="display:flex;"><span>builder.Services.AddSingleton&lt;IWhitelistRepository, WhitelistRepository&gt;();
</span></span></code></pre></div><blockquote>
<p>延伸閱讀：<a href="https://learn.microsoft.com/zh-tw/aspnet/core/fundamentals/http-context?view=aspnetcore-8.0#access-httpcontext-from-custom-components">存取 ASP.NET Core 中的 HttpContext</a> 的「從自訂元件存取 HttpContext」小節</p></blockquote>
<blockquote>
<p>備註：如果 FeatureFilter 依賴對象的生命週期是 Scope 的，會需要調整一下 FeatureManagement 的註冊，請看這一小節最後的補充。</p></blockquote>
<p>上游的假資料準備好了，接著就讓我們來實作白名單 FeatureFilter 吧：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Filters/WhitelistFilter.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// 白名單啟用 API 的 Filter</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// &lt;/summary&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">[FilterAlias(&#34;Whitelist&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WhitelistFilter</span> : IFeatureFilter
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IWhitelistRepository _whitelistRepository;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IHttpContextAccessor _httpContextAccessor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> WhitelistFilter(
</span></span><span style="display:flex;"><span>        IWhitelistRepository whitelistRepository, 
</span></span><span style="display:flex;"><span>        IHttpContextAccessor httpContextAccessor)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _whitelistRepository = whitelistRepository;
</span></span><span style="display:flex;"><span>        _httpContextAccessor = httpContextAccessor;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;<span style="color:#66d9ef">bool</span>&gt; EvaluateAsync(FeatureFilterEvaluationContext context)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 粗暴地從 Request 的 Header 取出使用者名稱</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 實作時記得換成真正的使用者資訊來源，例如 JWT Token、拆好的 User 資訊、擲筊的結果，之類的</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> user = _httpContextAccessor.HttpContext?.Request.Headers[<span style="color:#e6db74">&#34;User&#34;</span>]; 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">string</span>.IsNullOrWhiteSpace(user))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 假裝從資料庫中取得白名單，檢查使用者是否在白名單中</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 實作時記得換成真正的白名單來源 &amp; 比對邏輯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> whitelist = <span style="color:#66d9ef">await</span> _whitelistRepository.GetWhitelistAsync();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> whitelist.Any(x =&gt; x.Equals(user, StringComparison.OrdinalIgnoreCase)); <span style="color:#75715e">// 插個不分大小寫，避免我等等 Demo 手殘</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>搞定，開開心心來註冊囉：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Program.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder.Services
</span></span><span style="display:flex;"><span>    .AddFeatureManagement()
</span></span><span style="display:flex;"><span>    .AddFeatureFilter&lt;RandomFilter&gt;()
</span></span><span style="display:flex;"><span>    .AddFeatureFilter&lt;WhitelistFilter&gt;(); <span style="color:#75715e">// 把白名單的 FeatureFilter 掛上去</span>
</span></span></code></pre></div><p>接著捏支 API 來測測看：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Controllers/DemoController.cs</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">[HttpGet(&#34;FeatureFilter/Whitelist/&#34;)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;<span style="color:#66d9ef">string</span>&gt; FeatureFilterWhitelist(
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [FromHeader(Name = &#34;User&#34;)]</span> <span style="color:#66d9ef">string</span> user)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Demo 4: 實作：使用 IFeatureFilter 來根據白名單啟用 API</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> isEnabled = <span style="color:#66d9ef">await</span> _featureManager.IsEnabledAsync(FeatureFlags.Whitelist);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> isEnabled 
</span></span><span style="display:flex;"><span>        ? <span style="color:#e6db74">$&#34;{user} 先生/小姐，你好。歡迎使用本服務。您是我們第 9999 位 VIP 會員！&#34;</span>
</span></span><span style="display:flex;"><span>        : <span style="color:#e6db74">$&#34;{user} 先生/小姐，你好。很抱歉，本服務尚未開放給您使用。請加入我們的 VIP 會員，取得優先體驗資格！&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>來張動圖看看成果：</p>
<p>


<img
  src="https://image.igouist.net/r2gIrLw.gif"
  alt="Image"width="1368" height="1485"loading="auto" decoding="async">
</p>
<p>搞定，收工。又是美好的一天，準時下班囉</p>
<blockquote>
<p>補充：由於 FeatureManager 是 Singleton 的，而 AddFeatureFilter 會根據 FeatureManager 的生命週期來註冊 FeatureFilter，因此如果依賴對象的生命週期是 Scope，注入的時候就會發生錯誤。</p>
<p>這時候請改用 AddScopedFeatureManagement：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#75715e">// Program.cs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// builder.Services.AddFeatureManagement();</span>
</span></span><span style="display:flex;"><span>builder.Services.AddScopedFeatureManagement();
</span></span></code></pre></div><p>參考：<a href="https://github.com/microsoft/FeatureManagement-Dotnet/issues/15">Unable to inject Scoped/Transient services into FeatureFilter · Issue #15 · microsoft/FeatureManagement-Dotnet</a></p>
<p>延伸閱讀：<a href="https://igouist.github.io/post/2021/11/newbie-6-dependency-injection/#%E4%BE%9D%E8%B3%B4%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%89%E7%A8%AE%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F-transientscopedsingleton">依賴注入的三種生命週期 Transient、Scoped、Singleton</a></p></blockquote>
<h2 id="小結">小結</h2>
<p>稍微玩了一下 FeatureManagement，並且拿了一些前陣子遇過的場景來實作看看</p>
<p>原本以為只是簡單的去組態抓開關，想不到 FeatureFilter 提供的自訂條件還蠻彈性的，挺香</p>
<p>FeatureGate 無腦噴 404 也挺爽的（警告：請跟呼叫端的朋朋喬好= = 不然很危險，生命危險）</p>
<p>如果有想要搞個 Feature Flag 的場合，推薦可以玩玩看。</p>
<p>那麼，今天的筆記就到這邊。我們下篇見～</p>
<h2 id="參考資料">參考資料</h2>
<ul>
<li><a href="https://learn.microsoft.com/zh-tw/azure/azure-app-configuration/use-feature-flags-dotnet-core">如何在 .NET 應用程式中使用功能旗標的教學課程 | Microsoft Learn</a></li>
<li><a href="https://dotblogs.com.tw/supershowwei/2020/11/02/154134">[料理佳餚] ASP.NET Core 的 Feature Flags（Feature Toggle） | 軟體主廚的程式料理廚房</a></li>
<li>延伸閱讀（搭配 Azure App Configuration）
<ul>
<li><a href="https://learn.microsoft.com/zh-tw/azure/azure-app-configuration/feature-management-dotnet-reference?pivots=stable-version">.NET 功能旗標管理 - Azure App Configuration | Microsoft Learn</a></li>
<li><a href="https://dotblogs.com.tw/anyun/2022/10/16/160158">使用 App Configuration 的 Feature manager 功能來實做 Feature Toggle/Flag 機制 | 黯雲端記事錄</a></li>
</ul>
</li>
</ul>
                            <hr/>
                        </div>

                        

<div class="post-archive">
    <h2>其他文章</h2>
    <ul class="listing">
        
        <li><a href="/post/2024/08/dotnet-ioptions/">.Net: 使用 IOptions 取得 appsettings.json 的設定值吧</a></li>
        
        <li><a href="/post/2023/01/banner-1-system-drawing/">使用 .Net 的 System.Drawing 產生簡單的文字 Banner 初體驗</a></li>
        
        <li><a href="/post/2022/03/newbie-7-fluent-validation/">菜雞新訓記 (7): 使用 Fluent Validation 來驗證參數吧</a></li>
        
        <li><a href="/post/2021/11/newbie-6-dependency-injection/">菜雞新訓記 (6): 使用 依賴注入 (Dependency Injection) 來解除強耦合吧</a></li>
        
        <li><a href="/post/2021/10/newbie-5-3-layer-architecture/">菜雞新訓記 (5): 使用 三層式架構 來切分服務的關注點和職責吧</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://igouist.github.io/tags/csharp">csharp</a></li>
                                
                                <li><a href="https://igouist.github.io/tags/dotnet">dotnet</a></li>
                                
                                <li><a href="https://igouist.github.io/tags/appsettings">appsettings</a></li>
                                
                            </ul>
                            
                        </div>
                        <hr/>
                        <p>哈囉，如果你也有 LikeCoin，也覺得我的文章有幫上忙的話，還請不吝給我拍拍手呦，謝謝～ ;) </p>
<iframe class="LikeCoin" height="190" src="https://button.like.co/in/embed/igouist/button?referrer=https%3a%2f%2figouist.github.io%2fpost%2f2024%2f08%2fdotnet-feature-flag-and-feature-management%2f" width="100%" frameborder=0></iframe>
                    </article>
                    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "Igouist/Igouist.github.io"
            issue-term="pathname"
            theme="github-dark"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://igouist.github.io/">
      <button type="submit" class="submit">&#x1F50E;&#xFE0E;</button>
</form>
    </section>
    
    
        <section class="widget">
            <h3 class="widget-title">文章目錄</h3>
            <ul class="widget-list">
                <nav id="TableOfContents">
  <ul>
    <li><a href="#認識一下-feature-flag">認識一下 Feature Flag</a></li>
    <li><a href="#環境準備microsoftfeaturemanagement">環境準備：Microsoft.FeatureManagement</a></li>
    <li><a href="#實作使用-isenabledasync-拿到-feature-flag-的值">實作：使用 IsEnabledAsync 拿到 Feature Flag 的值</a></li>
    <li><a href="#實作使用-featuregate-來啟用和停用-api">實作：使用 FeatureGate 來啟用和停用 API</a></li>
    <li><a href="#實作使用-featurefilter-自訂篩選條件隨機抽取使用者">實作：使用 FeatureFilter 自訂篩選條件、隨機抽取使用者</a></li>
    <li><a href="#實作使用-featurefilter-來根據白名單啟用-api">實作：使用 FeatureFilter 來根據白名單啟用 API</a></li>
    <li><a href="#小結">小結</a></li>
    <li><a href="#參考資料">參考資料</a></li>
  </ul>
</nav>
            </ul>
        </section>
    
    
    <section class="widget">
        <h3 class="widget-title">系列文</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://igouist.github.io/series/%E6%88%91%E8%A6%81%E8%A8%82%E4%BE%BF%E7%95%B6/">我要訂便當 (5)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/series/%E8%8F%9C%E9%9B%9E%E6%96%B0%E8%A8%93%E8%A8%98/">菜雞新訓記 (8)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/series/%E8%8F%9C%E9%9B%9E%E8%88%87%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91/">菜雞與物件導向 (17)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <small class="date">2025-07-31</small>
        <a href="https://igouist.github.io/post/2025/07/migrate-blog-images-to-cloudflare-r2/" title="記一次把部落格圖片從 Imgur 搬到 Cloudflare R2 的過程">記一次把部落格圖片從 Imgur 搬到 Cloudflare R2 的過程</a>
    </li>
    
    <li>
        <small class="date">2025-07-07</small>
        <a href="https://igouist.github.io/post/2025/07/dotnet-add-watermark-and-password-to-pdf-using-pdfsharp/" title="C#: 使用 PDFSharp 在 PDF 加上浮水印和檔案密碼吧">C#: 使用 PDFSharp 在 PDF 加上浮水印和檔案密碼吧</a>
    </li>
    
    <li>
        <small class="date">2025-06-29</small>
        <a href="https://igouist.github.io/post/2025/06/dotnet-using-iservicecollection-extensions-to-enforce-registration-constraints/" title=".Net: 善用 IServiceCollection Extension 和自製 Builder，讓服務註冊更有約束吧">.Net: 善用 IServiceCollection Extension 和自製 Builder，讓服務註冊更有約束吧</a>
    </li>
    
    <li>
        <small class="date">2025-06-14</small>
        <a href="https://igouist.github.io/post/2025/06/imgur-temporarily-over-capacity-maybe-your-ip-banned/" title="Imgur 一直 temporarily over capacity 嗎？先檢查網路看看吧">Imgur 一直 temporarily over capacity 嗎？先檢查網路看看吧</a>
    </li>
    
    <li>
        <small class="date">2025-06-14</small>
        <a href="https://igouist.github.io/post/2025/06/disable-onedrive-sync-and-restore-documents-folder/" title="Windows: 關閉 OneDrive 同步，並把我的文件移回預設路徑">Windows: 關閉 OneDrive 同步，並把我的文件移回預設路徑</a>
    </li>
    
    <li>
        <small class="date">2025-05-05</small>
        <a href="https://igouist.github.io/post/2025/05/csharp-convert-html-to-pdf-using-dinktopdf/" title="C#: 使用 DinkToPdf 把 HTML 轉成 PDF 吧">C#: 使用 DinkToPdf 把 HTML 轉成 PDF 吧</a>
    </li>
    
    <li>
        <small class="date">2025-04-27</small>
        <a href="https://igouist.github.io/post/2025/04/shin-sangoku-musou-origins/" title="《真三國無雙：起源》白金心得">《真三國無雙：起源》白金心得</a>
    </li>
    
    <li>
        <small class="date">2025-04-24</small>
        <a href="https://igouist.github.io/post/2025/04/timberborn/" title="《河狸浮生記》體驗版遊玩心得">《河狸浮生記》體驗版遊玩心得</a>
    </li>
    
    <li>
        <small class="date">2025-02-01</small>
        <a href="https://igouist.github.io/post/2025/02/jmeter-constant-throughput-timer/" title="JMeter: 使用 Constant Throughput Timer 設置固定吞吐量">JMeter: 使用 Constant Throughput Timer 設置固定吞吐量</a>
    </li>
    
    <li>
        <small class="date">2025-01-12</small>
        <a href="https://igouist.github.io/post/2025/01/wakatime-hide-project-name-and-offline-and-initialized/" title="WakaTime: 隱藏敏感資訊、開啟離線暫存、卡在 Initialized 時的參考解法">WakaTime: 隱藏敏感資訊、開啟離線暫存、卡在 Initialized 時的參考解法</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        

<h3 class="widget-title"><a href="https://igouist.github.io/timeline/">最近動態</a></h3>
<ul class="widget-list timeline-widget">
  
    
    <li>
      <small class="date">2026-01-26</small>
      <a href="https://igouist.github.io/timeline/#t-1769432400">
        
        
        
          《真三國無雙：起源》四英傑 DLC 劇情初通關心得
        
      </a>
    </li>
  
    
    <li>
      <small class="date">2026-01-06</small>
      <a href="https://igouist.github.io/timeline/#t-1767668400">
        
        
        
          陷阱街道
        
      </a>
    </li>
  
    
    <li>
      <small class="date">2025-12-29</small>
      <a href="https://igouist.github.io/timeline/#t-1767016800">
        
        
        
          霹靂力距
        
      </a>
    </li>
  
    
    <li>
      <small class="date">2025-12-22</small>
      <a href="https://igouist.github.io/timeline/#t-1766390640">
        
        
        
          無題
        
      </a>
    </li>
  
    
    <li>
      <small class="date">2025-12-22</small>
      <a href="https://igouist.github.io/timeline/#t-1766388600">
        
        
        
          Queue 無法解決過載問題
        
      </a>
    </li>
  
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">轉貼推薦</h3>
<ul class="widget-list">    
    
    <li>
        <a href="https://igouist.github.io/repost/">每天推薦一篇文章 (101)</a>
    </li>
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">分類</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://igouist.github.io/categories/android/">android (1)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/automation/">automation (3)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/azure/">azure (3)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/bug/">bug (4)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/csharp-and-dotnet/">csharp-and-dotnet (34)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/css/">css (1)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/explore/">explore (3)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/ide/">ide (5)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/life/">life (10)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/murmur/">murmur (1)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/object-oriented/">object-oriented (17)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/powershell/">powershell (2)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/python/">python (7)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/reading/">reading (4)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/tools/">tools (27)</a>
    </li>
    
    <li>
        <a href="https://igouist.github.io/categories/windows/">windows (3)</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友鏈</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://sunnyday0932.github.io/" title="Sian">🌙 Sian</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.facebook.com/arthurc.study" title="arthurc">亞瑟的學習筆記</a>
        </li>
        
        <li>
            <a target="_blank" href="https://kevintsengtw.blogspot.com/" title="mrkt">mrkt 的程式學習筆記</a>
        </li>
        
        <li>
            <a target="_blank" href="https://dddtw.hashnode.dev/" title="DDDTW">DDDTW Technical Blog</a>
        </li>
        
        <li>
            <a target="_blank" href="https://wellss12.github.io/" title="Wells">Wells</a>
        </li>
        
        <li>
            <a target="_blank" href="https://raychiutw.github.io/" title="ray">Ray&#39;s Notes</a>
        </li>
        
        <li>
            <a target="_blank" href="https://andrewliang25.github.io/" title="Andrew">Null Playground</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">標籤</h3>
<div class="tagcloud">
    
    <a href="https://igouist.github.io/tags/ai-tools/">ai-tools</a>
    
    <a href="https://igouist.github.io/tags/android/">android</a>
    
    <a href="https://igouist.github.io/tags/anglesharp/">anglesharp</a>
    
    <a href="https://igouist.github.io/tags/api/">api</a>
    
    <a href="https://igouist.github.io/tags/appsettings/">appsettings</a>
    
    <a href="https://igouist.github.io/tags/automapper/">automapper</a>
    
    <a href="https://igouist.github.io/tags/automation/">automation</a>
    
    <a href="https://igouist.github.io/tags/azure/">azure</a>
    
    <a href="https://igouist.github.io/tags/azure-functions/">azure-functions</a>
    
    <a href="https://igouist.github.io/tags/bandon/">bandon</a>
    
    <a href="https://igouist.github.io/tags/benchmarkdotnet/">benchmarkdotnet</a>
    
    <a href="https://igouist.github.io/tags/bug/">bug</a>
    
    <a href="https://igouist.github.io/tags/chrome/">chrome</a>
    
    <a href="https://igouist.github.io/tags/cloudflare/">cloudflare</a>
    
    <a href="https://igouist.github.io/tags/crawler/">crawler</a>
    
    <a href="https://igouist.github.io/tags/csharp/">csharp</a>
    
    <a href="https://igouist.github.io/tags/css/">css</a>
    
    <a href="https://igouist.github.io/tags/dapper/">dapper</a>
    
    <a href="https://igouist.github.io/tags/database/">database</a>
    
    <a href="https://igouist.github.io/tags/dotnet/">dotnet</a>
    
    <a href="https://igouist.github.io/tags/electron/">electron</a>
    
    <a href="https://igouist.github.io/tags/entity-framework/">entity framework</a>
    
    <a href="https://igouist.github.io/tags/enum/">enum</a>
    
    <a href="https://igouist.github.io/tags/excel/">excel</a>
    
    <a href="https://igouist.github.io/tags/game/">game</a>
    
    <a href="https://igouist.github.io/tags/git/">git</a>
    
    <a href="https://igouist.github.io/tags/headphone/">headphone</a>
    
    <a href="https://igouist.github.io/tags/heroku/">heroku</a>
    
    <a href="https://igouist.github.io/tags/ide/">ide</a>
    
    <a href="https://igouist.github.io/tags/imgur/">imgur</a>
    
    <a href="https://igouist.github.io/tags/life/">life</a>
    
    <a href="https://igouist.github.io/tags/line/">line</a>
    
    <a href="https://igouist.github.io/tags/line-notify/">line-notify</a>
    
    <a href="https://igouist.github.io/tags/linux/">linux</a>
    
    <a href="https://igouist.github.io/tags/markdown/">markdown</a>
    
    <a href="https://igouist.github.io/tags/midjourney/">midjourney</a>
    
    <a href="https://igouist.github.io/tags/mysql/">mysql</a>
    
    <a href="https://igouist.github.io/tags/newbieguide/">newbieguide</a>
    
    <a href="https://igouist.github.io/tags/object-oriented/">object-oriented</a>
    
    <a href="https://igouist.github.io/tags/one-drive/">one-drive</a>
    
    <a href="https://igouist.github.io/tags/pdf/">pdf</a>
    
    <a href="https://igouist.github.io/tags/php/">php</a>
    
    <a href="https://igouist.github.io/tags/powershell/">powershell</a>
    
    <a href="https://igouist.github.io/tags/ptt/">ptt</a>
    
    <a href="https://igouist.github.io/tags/python/">python</a>
    
    <a href="https://igouist.github.io/tags/queue/">queue</a>
    
    <a href="https://igouist.github.io/tags/reading/">reading</a>
    
    <a href="https://igouist.github.io/tags/rrs/">rrs</a>
    
    <a href="https://igouist.github.io/tags/selenium/">selenium</a>
    
    <a href="https://igouist.github.io/tags/service-bus/">service-bus</a>
    
    <a href="https://igouist.github.io/tags/soft-skills/">soft-skills</a>
    
    <a href="https://igouist.github.io/tags/sqlite/">sqlite</a>
    
    <a href="https://igouist.github.io/tags/swagger/">swagger</a>
    
    <a href="https://igouist.github.io/tags/tools/">tools</a>
    
    <a href="https://igouist.github.io/tags/travel/">travel</a>
    
    <a href="https://igouist.github.io/tags/visualstudio/">visualstudio</a>
    
    <a href="https://igouist.github.io/tags/vscode/">vscode</a>
    
    <a href="https://igouist.github.io/tags/w3hexschool/">w3hexschool</a>
    
    <a href="https://igouist.github.io/tags/windows/">windows</a>
    
    <a href="https://igouist.github.io/tags/xampp/">xampp</a>
    
</div>
    </section>

    <section class="widget">
    <h3 class="widget-title">統計資訊</h3>
    <ul class="widget-list">
        <li>文章總數：107</li>

        
        <li>瀏覽次數：<span id="vercount_value_site_pv">-</span></li>
        

        <li>本站訂閱：<a href="https://igouist.github.io/index.xml" target="_blank"><u>RSS</u> (index.xml)</a></li>

        
        <li>本文字數：4879</li>
        

        

        
        
        
    </ul>
</section>

    <section class="widget">
    <h3 class="widget-title">工商服務</h3>
    <ul class="widget-list">

        
        <a href="https://www.facebook.com/@DDDCommunity.tw/"><img src="https://i.imgur.com/5ItLxex.png" alt="DDDTaiwan" style="width:245px;height:auto;"></a>
        <br/>

        
        
        

        
        <script async 
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2119949858103459"
            crossorigin="anonymous"></script>
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-2119949858103459"
            data-ad-slot="9031038367"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </ul>
</section>

</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2019-2025 <a href="https://igouist.github.io/">伊果的沒人看筆記本 By Igouist</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript">
    
    (function(){
        
    }())

    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>



<script defer src="https://events.vercount.one/js"></script>





<script type='text/javascript'>
    window.onload = function() {
      var links = document.links;
      for (var i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname != window.location.hostname) {
          links[i].target = '_blank';
        }
      }
    }
  </script>
</body>
</html>
